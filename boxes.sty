\ProvidesPackage{prettytex/boxes}
\RequirePackage{prettytex/base}

\usepackage{framed}
\usepackage[many]{tcolorbox}
\usepackage{varwidth}

\tcbuselibrary{skins}

% Leftbar box
\renewenvironment{leftbar}[1][\hsize]{
  \def\FrameCommand{
    {\color{themecolor}\vrule width 3pt}%
    \hspace{0pt}
    \fboxsep=.8cm\colorbox{lightgreybg}%
  }
  \MakeFramed{\hsize#1\advance\hsize-\width\FrameRestore}
}{\endMakeFramed}

% magic for setting tcolor-box theorem-counters
% use with \settcbcounter{<thm-name>}{<num>}
\newcommand{\providetcbcountername}[1]{%
  \@ifundefined{c@tcb@cnt@#1}{%
    --undefined--%
  }{%
    tcb@cnt@#1%
  }
}

\newcommand{\settcbcounter}[2]{%
  \@ifundefined{c@tcb@cnt@#1}{%
    \GenericError{Error}{counter name #1 is no tcb counter }{}{}%
  }{%
    \setcounter{tcb@cnt@#1}{#2}%
   }%
}%

\newcommand{\displaytcbcounter}[1]{% Wrapper for \the...
  \@ifundefined{thetcb@cnt@#1}{%
    \GenericError{Error}{counter name #1 is no tcb counter }{}{}%
  }{%
    \csname thetcb@cnt@#1\endcsname% 
  }%
}

% Theorem box
% round style:
\newcommand{\thmbox}[5]{
  \newtcbtheorem[number within=#5]{#1}{#2}{%
    enhanced jigsaw, frame empty, interior empty, colframe=#3!50,%
    coltitle=#3,fonttitle=\bfseries,colbacktitle=#3!20,%
    borderline={0.5mm}{0mm}{#3!50},%
    colback=white,top=5mm,
    attach boxed title to top center={yshift=-3mm},%
    %varwidth boxed title,
    breakable%
  }{#4}
}

\DeclareOption{sharp}{
  \renewcommand{\thmbox}[5]{
    % sharp style:
    \newtcbtheorem[number within=#5]{#1}{#2}{    
      theorem style=change apart,
      breakable,
      enhanced,
      title=#3,
      colframe=#3,
      colback=white,
      coltitle=black,
      colbacktitle=#3!30,
      boxrule=0pt,
      leftrule=2pt,
      fonttitle=\bfseries,
      sharp corners
    }{#4}
  }
}
\ProcessOptions\relax
